{% extends "tracker/base.html" %}
{% block title %}Log in Â· Nutramigo {% endblock %}

{% block content %}
<div class="auth-hero position-relative overflow-hidden py-5">
  <div class="auth-bg-shapes"></div>

  <div class="container-xl">
    <div class="row align-items-center justify-content-center g-5">

      <!-- Login Card -->
      <div class="col-lg-5">
        <div class="glass-card p-4 p-md-5 shadow-lg">
          <div class="d-flex align-items-center gap-2 mb-3">
            <i class="bi bi-activity text-primary fs-3"></i>
            <h1 class="h3 m-0">Welcome back</h1>
          </div>

          {% if form.errors or form.non_field_errors %}
            <div class="alert alert-danger small">
              {% for e in form.non_field_errors %}{{ e }}<br>{% endfor %}
              {% for field in form %}
                {% for e in field.errors %}
                  {{ field.label }}: {{ e }}<br>
                {% endfor %}
              {% endfor %}
            </div>
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}
            {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

            <div class="mb-3">
              <label class="form-label" for="id_username">Username</label>
              <input type="text" name="username" id="id_username"
                     class="form-control form-control-lg"
                     required autocomplete="username"
                     value="{{ form.username.value|default:'' }}">
            </div>

            <div class="mb-2">
              <label class="form-label" for="id_password">Password</label>
              <div class="password-field">
                <input type="password" name="password" id="id_password"
                       class="form-control form-control-lg" required
                       autocomplete="current-password">
                <button type="button" class="btn btn-sm btn-outline-secondary toggle-pass" aria-label="Show password">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
              {% url 'password_reset' as pw_url %}
              {% if pw_url %}
                <a href="{{ pw_url }}" class="small text-decoration-none">Forgot password?</a>
              {% endif %}
              {% url 'signup' as su_url %}
              {% if su_url %}
                <a href="{{ su_url }}" class="small text-decoration-none">Create account</a>
              {% endif %}
            </div>

            <!-- Inside your login form footer row -->
<div class="d-flex justify-content-between align-items-center mt-2">
  <div class="form-check">
    <input class="form-check-input" type="checkbox" value="1" id="remember" name="remember">
    <label class="form-check-label" for="remember">Remember me</label>
  </div>
  </div>


            <button class="btn btn-primary btn-lg w-100" type="submit">Log in</button>
          </form>
        </div>
      </div>

      <!-- Right-side hero copy (hidden on mobile) -->
      <div class="col-lg-6 d-none d-lg-block">
        <div class="hero-copy">
          <span class="badge bg-primary-subtle text-primary mb-3">
            <i class="bi bi-stars me-1"></i> Your daily nutrition copilot
          </span>
          <h2 class="display-6 fw-semibold">
            Track Meals. Hit your goals. <span class="text-primary">Feel great. Look great.</span>
          </h2>
          <p class="lead text-secondary">
            Set calorie and macro targets, log foods in seconds, and let the coach suggest what to eat next.
          </p>
          <ul class="list-unstyled mt-4">
            <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>AI meal suggestions based on your remaining macros for the day</li>
            <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Favorites, quick add, and OpenFoodFacts search</li>
            <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>Weekly charts and one-click CSV export</li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Autofocus
  document.getElementById('id_username')?.focus();

  // Show/hide password
  const btn = document.querySelector('.toggle-pass');
  const pwd = document.getElementById('id_password');
  btn?.addEventListener('click', () => {
    const show = pwd.type === 'password';
    pwd.type = show ? 'text' : 'password';
    btn.innerHTML = show ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
  });
});
</script>
{% endblock %}
